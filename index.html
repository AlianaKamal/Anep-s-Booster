<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Booster</title>
    <style>
        body {
            background-color: #ffe4e1;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: sans-serif;
            text-align: center;
            overflow: hidden; /* Tambah ini untuk elak scrollbar semasa animasi */
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 400px;
        }
        #pet-display {
            width: 150px; /* Saiz gambar */
            height: 150px;
            border-radius: 50%; /* Bentuk bulat untuk gambar */
            object-fit: cover; /* Pastikan gambar muat dalam bulatan */
            margin-bottom: 10px;
            border: 4px solid #ff69b4;
            /* Update transition untuk menampung pelbagai animasi */
            transition: transform 0.3s ease-out, border-color 0.5s, opacity 0.3s;
        }
        #status-message {
            margin-bottom: 10px;
            color: #ff69b4;
            font-weight: bold;
        }
        .buttons button {
            padding: 10px 15px;
            margin: 5px;
            font-size: 1em;
            cursor: pointer;
            background-color: #ff69b4;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .meter {
            width: 100%;
            background-color: #f0f0f0;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .progress {
            width: 50%; /* Lebar awal */
            height: 20px;
            background-color: #ff1493; /* Warna merah jambu terang */
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
            text-align: center;
            line-height: 20px;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hi B (B for Brader)</h1>
        <!-- Gantikan 'my_image.png' dengan pautan gambar anda -->
        <img id="pet-display" src="ratna_normal.png" alt="Gambar Pet Maya">
        
        <div class="meter">
            <div id="health-bar" class="progress">Kesihatan</div>
        </div>
        
        <div id="status-message">Hai Anep!</div>
        <div class="buttons">
            <button onclick="feedPet()">Beri Makan üçî</button>
            <button onclick="petPet()">Pujuk ü§ó</button>
            <button onclick="sendKiss()">Send Kiss üòò</button>
        </div>
    </div>

<script>
    const petDisplay = document.getElementById('pet-display');
    const statusMessage = document.getElementById('status-message');
    const healthBar = document.getElementById('health-bar');

    // Status awal (skala 0 hingga 100)
    let health = 100;
    // Fungsi utiliti untuk tukar gambar
    function changeImage(imageSrc) {
        petDisplay.src = imageSrc;
    }

    // Fungsi apabila memberi makan
    function feedPet() {
        health = Math.min(100, health + 15);
        updatePetStatus("Yummy! Masyeh Anep! üòã");
        changeImage('ratna_makan.png'); // Tukar gambar makan
        // Animasi melantun kecil
        petDisplay.style.transform = 'translateY(-10px)'; 
        setTimeout(() => { petDisplay.style.transform = 'translateY(0px)'; }, 300);
    }

    // Fungsi apabila membelai
    function petPet() {
        health = Math.min(100, health + 10);
        updatePetStatus("Ocey, Tak Majuk Dah! ü•∞");
        changeImage('ratna_gembira.png'); // Tukar gambar gembira
        // Animasi bergoncang (pusing)
        petDisplay.style.transform = 'rotate(-5deg)'; 
        setTimeout(() => {
            petDisplay.style.transform = 'rotate(5deg)';
            setTimeout(() => { petDisplay.style.transform = 'rotate(0deg)'; }, 100);
        }, 100);
    }

    // Fungsi baharu: Hantar Ciuman
    function sendKiss() {
        health = Math.min(100, health + 5); // Ciuman pun baik untuk kesihatan!
        updatePetStatus("Muaahh! üíñ");
        changeImage('ratna_kiss.png'); // Tukar gambar cium
        // Animasi skala (zoom in/out)
        petDisplay.style.transform = 'scale(1.2)';
        petDisplay.style.borderColor = '#FF0000'; // Tukar border kepada merah cinta

        setTimeout(() => {
            petDisplay.style.transform = 'scale(1)';
            petDisplay.style.borderColor = '#ff69b4'; // Kembali ke warna asal
        }, 500);
    }

    // Fungsi untuk kemas kini paparan dan mesej
    function updatePetStatus(message) {
        statusMessage.textContent = message;
        healthBar.style.width = `${health}%`;
        healthBar.textContent = `${health}% Mood Titew`;
        
        if (health < 30) {
            statusMessage.style.color = 'red';
        } else {
            statusMessage.style.color = '#ff69b4';
        }
    } 

    /* FUNGSI animatePet() ASAL DIBUANG KERANA LOGIK BARU SUDAH DILETAKKAN DALAM FUNGSI INTERAKSI */

    // Kesihatan berkurangan secara beransur-ansur dari masa ke masa
    setInterval(() => {
        health = Math.max(0, health - 2);
        
        if (health === 0) {
            updatePetStatus("Oh No! Anep Dah Tak Sayang Saya! üíÄ");
            changeImage('ratna_normal.png'); // Kembali ke gambar biasa bila tiada interaksi
        } else {
            updatePetStatus("Nak attention pwiss! ü•∫"); 
            // Apabila berkurangan, kita tetapkan semula gambar kepada normal jika ia bukan normal
            if (!petDisplay.src.includes('ratna_normal.png') && 
                !petDisplay.src.includes('ratna_makan.png') && 
                !petDisplay.src.includes('ratna_gembira.png') && 
                !petDisplay.src.includes('ratna_kiss.png')) {
                    // Hanya tukar jika gambar semasa tiada dalam senarai interaksi aktif
                     changeImage('ratna_normal.png');
            }
        }

    }, 3000); // Setiap 3 saat

    // Muatkan status awal
    updatePetStatus("Hai Anep! Jaga Titew baik-baik ya! üòä");
    // Pastikan imej awal adalah normal
    changeImage('ratna_normal.png');

</script>

    <!-- TAMBAHAN: paste selepas skrip JS asal anda (tidak ubah kod asal) -->
<style>
  /* sedikit gaya untuk butang baru dan canvas konfeti */
  #extrasBar { margin-top: 10px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap; }
  #extrasBar button { padding:8px 10px; border-radius:8px; border:none; background:#ff69b4; color:white; cursor:pointer; }
  #confettiCanvas { position:fixed; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index:9999; }
  #soundToggle{ background: #777; }
  #dailyBtn{ background: #ffb347; color: #111; }
  #levelBadge { font-weight:700; padding:6px 10px; border-radius:999px; background:#ffd6e8; color:#b10b5a;}
</style>

<!-- Elemen UI tambahan (letakkan di dalam .container anda jika mahu) -->
<div id="extrasBar" aria-hidden="false" style="margin-top:12px;">
  <button id="dailyBtn" title="Claim daily snack">Daily Snack</button>
  <button id="soundToggle" title="Toggle sound">üîä On</button>
  <button id="snapshotBtn" title="Download snapshot">Snapshot</button>
  <div id="levelBadge">Lvl 1</div>
</div>

<canvas id="confettiCanvas"></canvas>

<script>
/* === INTEGRATION LAYER (paste after original script) ===
   Works by wrapping original functions (no direct edit to original).
*/

/* safety: hanya jalankan jika fungsi asal wujud */
if (typeof window.feedPet === 'function' && typeof window.petPet === 'function' && typeof window.sendKiss === 'function') {

  /* ---------- persistent state ---------- */
  const STORAGE_KEY = 'petState_v1';
  const state = {
    health: (typeof health === 'number') ? health : 100,
    xp: Number(localStorage.getItem('pet_xp') || 0),
    level: Number(localStorage.getItem('pet_level') || 1),
    lastClaim: localStorage.getItem('pet_lastClaim') || null,
    mute: (localStorage.getItem('pet_mute') === '1'),
  };

  // sync initial health into global if exists
  if (typeof window.health === 'number') state.health = window.health;

  // UI refs
  const dailyBtn = document.getElementById('dailyBtn');
  const soundToggle = document.getElementById('soundToggle');
  const levelBadge = document.getElementById('levelBadge');
  const snapshotBtn = document.getElementById('snapshotBtn');

  // update level badge UI
  function updateLevelUI(){
    levelBadge.textContent = `Lvl ${state.level}`;
  }
  updateLevelUI();

  // save helper
  function saveState(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ health: state.health, xp: state.xp, level: state.level, lastClaim: state.lastClaim }));
    localStorage.setItem('pet_xp', String(state.xp));
    localStorage.setItem('pet_level', String(state.level));
    localStorage.setItem('pet_mute', state.mute ? '1' : '0');
  }

  // load stored health if ada
  (function loadStored(){
    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    if (typeof saved.health === 'number') {
      state.health = saved.health;
      // update global health & UI using existing function
      if (typeof window.health !== 'undefined') window.health = state.health;
      if (typeof window.updatePetStatus === 'function') window.updatePetStatus("Welcome back! üòä");
      // also update health bar width if present
      const hb = document.getElementById('health-bar');
      if (hb) { hb.style.width = `${state.health}%`; hb.textContent = `${state.health}% Mood Titew`; }
    }
  })();

  /* ---------- Audio setup ---------- */
  const sFeed = new Audio('sfx/eat.mp3');
  const sPet  = new Audio('sfx/purr.mp3');
  const sKiss = new Audio('sfx/kiss.mp3');
  [sFeed,sPet,sKiss].forEach(a => { a.preload = 'auto'; a.volume = 0.9; });

  function playSound(audio) {
    if (state.mute) return;
    audio.play().catch(()=>{ /* ignore autoplay block */ });
  }

  // toggle UI
  function refreshSoundToggleUI(){
    soundToggle.textContent = state.mute ? 'üîá Off' : 'üîä On';
    soundToggle.style.background = state.mute ? '#999' : '#28a745';
  }
  refreshSoundToggleUI();

  soundToggle.addEventListener('click', ()=>{
    state.mute = !state.mute;
    localStorage.setItem('pet_mute', state.mute ? '1' : '0');
    refreshSoundToggleUI();
  });

  /* ---------- Confetti (simple canvas burst) ---------- */
  const confCanvas = document.getElementById('confettiCanvas');
  const cctx = confCanvas.getContext ? confCanvas.getContext('2d') : null;
  function resizeCanvas(){
    if(!cctx) return;
    confCanvas.width = window.innerWidth;
    confCanvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function burstConfetti(x = window.innerWidth/2, y = window.innerHeight/3){
    if (!cctx) return;
    const parts = [];
    const colors = ['#ff69b4','#ff1493','#ffd700','#f06292'];
    for (let i=0;i<50;i++){
      parts.push({
        x, y,
        vx: (Math.random()-0.5)*8,
        vy: -Math.random()*8 - 2,
        r: 3 + Math.random()*6,
        c: colors[Math.floor(Math.random()*colors.length)],
        life: 70 + Math.floor(Math.random()*30)
      });
    }
    let t = 0;
    const anim = setInterval(()=>{
      cctx.clearRect(0,0,confCanvas.width, confCanvas.height);
      parts.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.vy += 0.25; p.life--;
        cctx.fillStyle = p.c;
        cctx.beginPath();
        cctx.ellipse(p.x, p.y, p.r, p.r*0.8, 0, 0, Math.PI*2);
        cctx.fill();
      });
      t++;
      if (t > 90) { clearInterval(anim); cctx.clearRect(0,0,confCanvas.width, confCanvas.height); }
    }, 16);
  }

  /* ---------- Level / XP system ---------- */
  function xpNeededFor(level){ return level * 50; }
  function addXP(amount){
    state.xp += amount;
    while (state.xp >= xpNeededFor(state.level)){
      state.xp -= xpNeededFor(state.level);
      state.level++;
      // unlock celebration
      burstConfetti();
      if (typeof window.updatePetStatus === 'function') window.updatePetStatus(`Level up! Now level ${state.level} üéâ`);
    }
    saveState();
    updateLevelUI();
  }

  /* ---------- Combo tap mini-game (feed) ---------- */
  let comboTaps = 0, comboTimer = null;
  function registerComboTap(){
    comboTaps++;
    if (comboTimer) clearTimeout(comboTimer);
    comboTimer = setTimeout(()=>{
      // evaluate combo
      if (comboTaps >= 5){
        // big reward
        state.health = Math.min(100, state.health + 40);
        if (typeof window.health !== 'undefined') window.health = state.health;
        if (typeof window.updatePetStatus === 'function') window.updatePetStatus('Combo! +40 üéØ');
        burstConfetti();
        addXP(30);
      } else if (comboTaps >= 3){
        state.health = Math.min(100, state.health + 20);
        if (typeof window.health !== 'undefined') window.health = state.health;
        if (typeof window.updatePetStatus === 'function') window.updatePetStatus('Nice combo! +20');
        addXP(15);
      } else {
        addXP(5);
      }
      // sync health UI
      const hb = document.getElementById('health-bar');
      if (hb) { hb.style.width = `${state.health}%`; hb.textContent = `${state.health}% Mood Titew`; }
      saveState();
      comboTaps = 0;
      comboTimer = null;
    }, 2500); // 2.5s window
  }

  /* ---------- Wrapping original functions (no edit original) ---------- */
  // preserve originals
  const origFeed = window.feedPet.bind(window);
  const origPet  = window.petPet.bind(window);
  const origKiss = window.sendKiss.bind(window);

  // redefine wrappers
  window.feedPet = function(...args){
    origFeed(...args);               // run original
    // sync state
    if (typeof window.health === 'number') state.health = window.health;
    // play sound
    playSound(sFeed);
    // small confetti & XP and save
    burstConfetti();
    addXP(10);
    saveState();
    // register combo tap
    registerComboTap();
  };

  window.petPet = function(...args){
    origPet(...args);
    if (typeof window.health === 'number') state.health = window.health;
    playSound(sPet);
    addXP(7);
    saveState();
  };

  window.sendKiss = function(...args){
    origKiss(...args);
    if (typeof window.health === 'number') state.health = window.health;
    playSound(sKiss);
    burstConfetti();
    addXP(4);
    saveState();
  };

  /* ---------- Daily reward button ---------- */
  dailyBtn.addEventListener('click', ()=>{
    const today = new Date().toISOString().slice(0,10);
    if (state.lastClaim === today){
      alert('Anda sudah tuntut Daily Snack hari ini!');
      return;
    }
    state.lastClaim = today;
    state.health = Math.min(100, state.health + 20);
    if (typeof window.health !== 'undefined') window.health = state.health;
    if (typeof window.updatePetStatus === 'function') window.updatePetStatus('Daily Snack! +20 üéÅ');
    burstConfetti();
    addXP(20);
    saveState();
  });

  /* ---------- Snapshot (download pet img + status) ---------- */
  snapshotBtn.addEventListener('click', async ()=>{
    // simple: capture pet image element as dataURL and trigger download
    try {
      const petImg = document.getElementById('pet-display');
      if (!petImg) throw 'No pet image';
      // draw the image into a temporary canvas
      const c = document.createElement('canvas');
      c.width = petImg.naturalWidth || 300;
      c.height = petImg.naturalHeight || 300;
      const ctx = c.getContext('2d');
      // white bg
      ctx.fillStyle = '#fff'; ctx.fillRect(0,0,c.width,c.height);
      // draw avatar centered
      ctx.drawImage(petImg, 0, 0, c.width, c.height);
      // add text
      ctx.fillStyle = '#000'; ctx.font = '18px sans-serif';
      ctx.fillText(`Health: ${state.health}%`, 10, c.height - 30);
      ctx.fillText(`Level: ${state.level}`, 10, c.height - 10);
      const url = c.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url; a.download = `pet_snapshot_${new Date().toISOString().slice(0,10)}.png`;
      document.body.appendChild(a); a.click(); a.remove();
    } catch (e){
      alert('Snapshot failed: ' + e);
    }
  });

  /* ---------- Save periodically and on exit ---------- */
  setInterval(saveState, 5000);
  window.addEventListener('beforeunload', saveState);

  // initial UI sync
  updateLevelUI();
  refreshSoundToggleUI();

} else {
  console.warn('Pet integration layer: original functions (feedPet/petPet/sendKiss) tidak ditemui. Pastikan kod asal dimuatkan dahulu.');
}
</script>

</body>
</html>


