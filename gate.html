<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Private â€” Mood Booster</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#ffecec;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .box{background:#fff;padding:24px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.08);width:360px;text-align:center}
    input{width:100%;padding:10px;margin:10px 0;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
    button{padding:10px 14px;border-radius:8px;border:none;background:#ff69b4;color:#fff;font-weight:700;cursor:pointer}
    .hint{font-size:13px;color:#666;margin-top:8px}
    #err{color:#c0392b;display:none;margin-top:8px}
    .row { display:flex; align-items:center; gap:8px; justify-content:flex-start; margin-top:6px; }
    label.small{font-size:14px;color:#444}
    .checkbox-row {
      display: flex;
      align-items: center;
      justify-content: center; /* center horizontally */
      gap: 8px; /* jarak comel */
      margin-top: 6px;
      font-size: 13px;
    }
    .checkbox-row input[type="checkbox"]{ width:16px; height:16px; }
    .sr-only{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
  </style>
</head>
<body>
  <div class="box" role="main" aria-label="Private gate">
    <h2>VIP Access: Boyfriend Edition</h2>
    <p>Masukkan kata kunci, macam awak kunci hati saya.</p>

    <!-- password input -->
    <label class="sr-only" for="pw">Kata Kunci</label>
    <input id="pw" type="password" placeholder="Birthday Cinta Hati (Awal No IC)" autocomplete="current-password" autofocus aria-label="Kata kunci" />

    <!-- FIXED: checkbox id is rememberMe and script reads same id -->
    <div class="checkbox-row" role="group" aria-label="Ingat saya">
      <input type="checkbox" id="rememberMe" aria-describedby="rememberHelp" />
      <label for="rememberMe" id="rememberHelp">Tick ni kalau awak nak saya stay.</label>
    </div>

    <button id="go" aria-describedby="err">Buka</button>

    <div id="err" role="alert" aria-live="polite">Dah Tak Ingat Birthday Saya Ke!</div>
    <div class="hint">Nota: akses ini untuk kegunaan peribadi sahaja.</div>
  </div>

<script>
  // ----- CONFIG -----
  // Masukkan SHA-256 hex password anda di sini (contoh). 
  // Jangan kongsi fail ini jika orang lain boleh baca repos anda.
  const PASSWORD_HASH = "dd33b09e18584afa3fb3797dedfe7114f36dc9264a13683a05ffc850ba60f9c0";
  const TOKEN_KEY = 'mood_booster_auth_v1';
  // default expiry (ms) for non-remembered tokens (7 days)
  const DEFAULT_EXPIRY_MS = 1000*60*60*24*7;

  async function sha256Hex(str){
    const enc = new TextEncoder();
    const data = enc.encode(str);
    const hash = await crypto.subtle.digest('SHA-256', data);
    const bytes = new Uint8Array(hash);
    return Array.from(bytes).map(b=>b.toString(16).padStart(2,'0')).join('');
  }

  // Save token. If remember=true -> persistent token (perm)
  function saveToken(remember){
    const ts = Date.now();
    if (remember) {
      // store perm token: 'ok:ts:perm'
      localStorage.setItem(TOKEN_KEY, `ok:${ts}:perm`);
    } else {
      // store expiring token: 'ok:ts'
      localStorage.setItem(TOKEN_KEY, `ok:${ts}`);
    }
  }

  // check token validity helper (used on gate and index)
  function isTokenValid(raw){
    if (!raw) return false;
    const parts = raw.split(':');
    if (parts[0] !== 'ok') return false;
    // perm token stays valid until removed
    if (parts[2] === 'perm') return true;
    const ts = parseInt(parts[1]) || 0;
    return (Date.now() - ts) < DEFAULT_EXPIRY_MS;
  }

  // helper to show/hide error nicely
  const errEl = document.getElementById('err');
  let errTimeout = null;
  function showError(msg){
    if (errTimeout) clearTimeout(errTimeout);
    errEl.textContent = msg;
    errEl.style.display = 'block';
    // auto-hide after 6s to keep UI clean
    errTimeout = setTimeout(()=>{ errEl.style.display = 'none'; }, 6000);
  }
  function hideError(){ errEl.style.display = 'none'; if (errTimeout) clearTimeout(errTimeout); }

  // on click
  document.getElementById('go').addEventListener('click', async ()=>{
    hideError();
    try {
      const pw = (document.getElementById('pw').value || '').trim();
      // READ CORRECT CHECKBOX ID HERE (rememberMe)
      const rememberEl = document.getElementById('rememberMe');
      const remember = rememberEl ? !!rememberEl.checked : false;

      if (!pw) { showError('Sila masukkan kata kunci.'); return; }
      const h = await sha256Hex(pw);
      if (h === PASSWORD_HASH){
        saveToken(remember);
        // small delay to ensure localStorage write
        setTimeout(()=> location.href = 'index.html', 80);
      } else {
        showError('Dah Tak Ingat Birthday Saya Ke!');
      }
    } catch (err) {
      console.error('Gate error', err);
      showError('Ralat. Buka Console untuk diagnosis.');
    }
  });

  // support pressing Enter on password field
  document.getElementById('pw').addEventListener('keydown', function(e){
    if (e.key === 'Enter') document.getElementById('go').click();
  });

  // auto-redirect if already have valid token
  (function checkToken(){
    try {
      const raw = localStorage.getItem(TOKEN_KEY);
      if (isTokenValid(raw)) {
        location.replace('index.html');
      }
    } catch(e){
      console.warn('checkToken failed', e);
    }
  })();

  /* ---------- Optional: compute hash locally (dev helper)
     Jika anda mahu tahu SHA-256 hex untuk password plaintext anda,
     buka gate.html di browser, buka Console (F12) dan jalankan:

       sha256Hex('your-plaintext-password').then(console.log)

     Kemudian salin hex yang terhasil ke const PASSWORD_HASH di atas.
     Ingat: jangan kongsi hex atau password dengan orang lain.
  */
</script>
</body>
</html>
